# –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å –∏ –∫–∞–Ω–∞–ª—ã –≤ Go

<details>
<summary><strong>üè† –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å –∏ –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º</strong></summary>

### –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
- **–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å**: –õ–æ–≥–∏—á–µ—Å–∫–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω—è—Ç—å –∑–∞–¥–∞—á–∏ _–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ_, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –Ω–∞ –æ–¥–Ω–æ–º —è–¥—Ä–µ CPU.
- **–ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º**: –§–∏–∑–∏—á–µ—Å–∫–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á _–æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ_ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —è–¥—Ä–∞—Ö CPU.

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ Go
- **–ì–æ—Ä—É—Ç–∏–Ω—ã**: –õ–µ–≥–∫–æ–≤–µ—Å–Ω—ã–µ –ø–æ—Ç–æ–∫–∏ (2 –ö–ë —Å—Ç–µ–∫–∞, –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Ä–∞—Å—à–∏—Ä—è—é—Ç—Å—è).
- **–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≥–æ—Ä—É—Ç–∏–Ω**:
  - **–°–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã** (–±–ª–æ–∫–∏—Ä—É—é—â–∏–µ I/O, sleep).
  - **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–∞–Ω–∞–ª–æ–≤** (–æ—Ç–ø—Ä–∞–≤–∫–∞/–ø—Ä–∏–µ–º).
  - **–Ø–≤–Ω—ã–π –≤—ã–∑–æ–≤** `runtime.Gosched()`.
  - **Preemption** –æ—Ç Sysmon (–ø—Ä–∏ –¥–æ–ª–≥–∏—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏—è—Ö >10 –º—Å).

```go
// –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ sysmon
func infiniteLoop() {
    for { /* Sysmon –ø—Ä–µ—Ä–≤–µ—Ç —á–µ—Ä–µ–∑ 10 –º—Å */ }
}
```

### –ö–æ–≥–¥–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ?
- **–ö–æ–æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–∞—è –º–Ω–æ–≥–æ–∑–∞–¥–∞—á–Ω–æ—Å—Ç—å**: –ì–æ—Ä—É—Ç–∏–Ω–∞ —Å–∞–º–∞ –æ—Ç–¥–∞–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (–∫–∞–Ω–∞–ª—ã, syscall).
- **–í—ã—Ç–µ—Å–Ω—è—é—â–∞—è**: Sysmon –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç "–∂–∞–¥–Ω—ã–µ" –≥–æ—Ä—É—Ç–∏–Ω—ã.
</details>

<details>
<summary><strong>‚öôÔ∏è –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ Go (Scheduler)</strong></summary>

### –ú–æ–¥–µ–ª—å PMG
- **P (Processor)**: –õ–æ–≥–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ = `GOMAXPROCS`).
- **M (Machine)**: –ü–æ—Ç–æ–∫ –û–° (—É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–æ–º).
- **G (Goroutine)**: –ó–∞–¥–∞—á–∞.

### –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã P
1. **–õ–æ–∫–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å (LRQ)**: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–≤–æ–∏ G.
2. **–ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å (GRQ)**: –ë–µ—Ä–µ—Ç 1 G –∫–∞–∂–¥—ã–µ 61 —à–∞–≥ (–¥–ª—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏).
3. **Work-stealing**: –ö—Ä–∞–¥–µ—Ç 50% G –∏–∑ LRQ –¥—Ä—É–≥–æ–≥–æ P.

```go
// –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã P
runtime.GOMAXPROCS(4) // 4 P —Å–æ–∑–¥–∞–¥—É—Ç 5 —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤
```

### –ú–µ—Ö–∞–Ω–∏–∑–º—ã
- **Handoff**: –ü—Ä–∏ –±–ª–æ–∫–∏—Ä—É—é—â–µ–º syscall P –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç M, —á—Ç–æ–±—ã –¥—Ä—É–≥–∏–µ G –º–æ–≥–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —è–¥—Ä–∞.
- **Sysmon**: –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç:
    - –°–µ—Ç–µ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ **Netpoller** (epoll/kqueue).
    - –î–æ–ª–≥–∏–µ G (>10 –º—Å) ‚Üí preemption.
- **Netpoller**: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–µ—Ç–µ–≤—ã–µ –≤—ã–∑–æ–≤—ã, –Ω–µ –±–ª–æ–∫–∏—Ä—É—è M.

### –û—á–µ—Ä–µ–¥–∏
- **LRQ**: –õ–æ–∫–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å P (–¥–æ 256 G).
- **GRQ**: –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å –¥–ª—è –Ω–æ–≤—ã—Ö G.

### –ü–æ—Ç–æ–∫–∏ (M)
- –°—Ç–∞—Ä—Ç—É—é—Ç –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ (–¥–æ –ª–∏–º–∏—Ç–∞ `ulimit -n`).
- –ü—Ä–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ (syscall) ‚Üí –Ω–æ–≤—ã–π M —Å–æ–∑–¥–∞–µ—Ç—Å—è –¥–ª—è –¥—Ä—É–≥–∏—Ö G.

### –ö–∞–∫ –≥–æ—Ä—É—Ç–∏–Ω—ã –ø–æ–ø–∞–¥–∞—é—Ç –≤ Netpoller?
1. **–°–µ—Ç–µ–≤–æ–π –≤—ã–∑–æ–≤**: –ì–æ—Ä—É—Ç–∏–Ω–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, `conn.Read()`).
2. **–ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–π —Ä–µ–∂–∏–º**: Go –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç —Å–æ–∫–µ—Ç –≤ –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–π —Ä–µ–∂–∏–º.
3. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ Netpoller**:
  - –§–∞–π–ª–æ–≤—ã–π –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä —Å–æ–∫–µ—Ç–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ `epoll/kqueue/IOCP`.
  - –ì–æ—Ä—É—Ç–∏–Ω–∞ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—Å—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ **–æ–∂–∏–¥–∞–Ω–∏—è** (Gwaiting).
4. **–û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤**:
  - P –æ—Ç–∫—Ä–µ–ø–ª—è–µ—Ç—Å—è –æ—Ç M (–µ—Å–ª–∏ —ç—Ç–æ —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤).
  - M –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –¥—Ä—É–≥–∏–µ –≥–æ—Ä—É—Ç–∏–Ω—ã.

### –ö–∞–∫ –≥–æ—Ä—É—Ç–∏–Ω—ã –≤—ã—Ö–æ–¥—è—Ç –∏–∑ Netpoller?
1. **–°–æ–±—ã—Ç–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏**: –û–° —É–≤–µ–¥–æ–º–ª—è–µ—Ç Netpoller –æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ —Å–æ–∫–µ—Ç–∞ (–¥–∞–Ω–Ω—ã–µ –ø—Ä–∏—à–ª–∏, –º–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å).
2. **–ü—Ä–æ–±—É–∂–¥–µ–Ω–∏–µ –≥–æ—Ä—É—Ç–∏–Ω—ã**:
  - Netpoller –ø–æ–º–µ—á–∞–µ—Ç –≥–æ—Ä—É—Ç–∏–Ω—É –∫–∞–∫ **–≥–æ—Ç–æ–≤—É—é –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é**.
  - –ì–æ—Ä—É—Ç–∏–Ω–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ **–≥–ª–æ–±–∞–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å (GRQ)** P.
3. **–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**:
  - –ö–æ–≥–¥–∞ P –ø–æ–ª—É—á–∏—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, –æ–Ω –Ω–∞—á–Ω–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –ø—Ä–æ–±—É–∂–¥–µ–Ω–Ω—É—é –≥–æ—Ä—É—Ç–∏–Ω—É.

### –ö–∞–∫–æ–π P –ø–æ–ª—É—á–∞–µ—Ç –ø—Ä–æ–±—É–∂–¥–µ–Ω–Ω—É—é –≥–æ—Ä—É—Ç–∏–Ω—É?
–ö–æ–≥–¥–∞ Netpoller (—á–µ—Ä–µ–∑ `epoll/kqueue/IOCP`) –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å —Å–æ–∫–µ—Ç–∞, –ø—Ä–æ–±—É–∂–¥–µ–Ω–Ω–∞—è –≥–æ—Ä—É—Ç–∏–Ω–∞ **–Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –∂–µ—Å—Ç–∫–æ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É P**.
–ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞:

1. **–û–±—â–∏–π —Å–ª—É—á–∞–π**:
  - –ì–æ—Ä—É—Ç–∏–Ω–∞ –ø–æ–º–µ—â–∞–µ—Ç—Å—è –≤ **–≥–ª–æ–±–∞–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å (GRQ)**.
  - –õ—é–±–æ–π —Å–≤–æ–±–æ–¥–Ω—ã–π P –º–æ–∂–µ—Ç –∑–∞–±—Ä–∞—Ç—å –µ—ë —á–µ—Ä–µ–∑ –º–µ—Ö–∞–Ω–∏–∑–º **work-stealing** –∏–ª–∏ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ GRQ (–∫–∞–∂–¥—ã–µ 61 —à–∞–≥).

2. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏ –∫ –∏—Å—Ö–æ–¥–Ω–æ–º—É P**:
  - –ï—Å–ª–∏ –≥–æ—Ä—É—Ç–∏–Ω–∞ –±—ã–ª–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ **–Ω–∞ –∫–æ—Ä–æ—Ç–∫–æ–µ –≤—Ä–µ–º—è** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –±—ã—Å—Ç—Ä–æ–µ —Å–µ—Ç–µ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ),
    runtime –ø—ã—Ç–∞–µ—Ç—Å—è –≤–µ—Ä–Ω—É—Ç—å –µ—ë –≤ **–ª–æ–∫–∞–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å (LRQ) –∏—Å—Ö–æ–¥–Ω–æ–≥–æ P** (–µ—Å–ª–∏ –æ–Ω –∞–∫—Ç–∏–≤–µ–Ω).
  - –≠—Ç–æ —É–ª—É—á—à–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –∏ —Å–Ω–∏–∂–∞–µ—Ç –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã.

3. **–°–∏—Å—Ç–µ–º–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä (Sysmon)**:
  - Sysmon –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç GRQ –∏ **—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≥–æ—Ä—É—Ç–∏–Ω—ã** –ø–æ LRQ —Å–≤–æ–±–æ–¥–Ω—ã—Ö P.
  - –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç "–≥–æ–ª–æ–¥–∞–Ω–∏–µ" –æ—Ç–¥–µ–ª—å–Ω—ã—Ö P.

```go
// –ü—Ä–∏–º–µ—Ä: –ß—Ç–µ–Ω–∏–µ –∏–∑ —Å–µ—Ç–∏ —Å –Ω–µ—è–≤–Ω—ã–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Netpoller
conn, _ := net.Dial("tcp", "example.com:80")
buf := make([]byte, 1024)
n, _ := conn.Read(buf) // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ç–æ–ª—å–∫–æ –≥–æ—Ä—É—Ç–∏–Ω—ã, –Ω–µ –ø–æ—Ç–æ–∫–∞!
```

**–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞**: –í—Å–µ —Å–µ—Ç–µ–≤—ã–µ –≤—ã–∑–æ–≤—ã –≤ Go –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç –ø–æ—Ç–æ–∫–∏ –û–°.

#### –î–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
 - –ü—Ä–∏ –≤—ã–∑–æ–≤–µ `conn.Read()` **runtime** –≤—ã–∑—ã–≤–∞–µ—Ç `runtime.netpollblock()`.

 - –î–∞–Ω–Ω—ã–µ –æ –≥–æ—Ä—É—Ç–∏–Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ —Å–æ–∫–µ—Ç–∞.

 - –ü–æ—Å–ª–µ —Å–æ–±—ã—Ç–∏—è **epoll_wait** –≥–æ—Ä—É—Ç–∏–Ω–∞ –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ **Runnable**.
</details>

<details>
<summary><strong>üåâ –ö–∞–Ω–∞–ª—ã (Channels)</strong></summary>

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ (runtime.hchan)
```go
type hchan struct {
	qcount   uint           // –∫–æ–ª-–≤–æ –¥–∞–Ω–Ω—ã—Ö –≤ –∫–æ–ª—å—Ü–µ–≤–æ–π –æ—á–µ—Ä–µ–¥–∏
	// other fields (dataqsize, elemtype, elemsize)
	closed   uint32         // –∑–∞–∫—Ä—ã—Ç –ª–∏ –∫–∞–Ω–∞–ª, uint32 –∏–∑-–∑–∞ –∞—Ç–æ–º–∞—Ä–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
    buf      unsafe.Pointer // –∫–æ–ª—å—Ü–µ–≤–æ–π –±—É—Ñ–µ—Ä
    sendx    uint           // –∏–Ω–¥–µ–∫—Å –æ—Ç–ø—Ä–∞–≤–∫–∏
    recvx    uint           // –∏–Ω–¥–µ–∫—Å –ø—Ä–∏–µ–º–∞
    lock     mutex          // –º—å—é—Ç–µ–∫—Å
    sendq    waitq          // –æ—á–µ—Ä–µ–¥—å –æ–∂–∏–¥–∞—é—â–∏—Ö –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª–µ–π
    recvq    waitq          // –æ—á–µ—Ä–µ–¥—å –æ–∂–∏–¥–∞—é—â–∏—Ö –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π
}
```

### –ù–µ–±—É—Ñ–µ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–∞–Ω–∞–ª
- **–û—Ç–ø—Ä–∞–≤–∫–∞**: –ë–ª–æ–∫–∏—Ä—É–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è, –ø–æ–∫–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—å –Ω–µ –≥–æ—Ç–æ–≤.
- **–ü—Ä–∏–µ–º**: –ë–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ–ª—É—á–∞—Ç–µ–ª—è, –ø–æ–∫–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å –Ω–µ –≥–æ—Ç–æ–≤.

```go
ch := make(chan int)
go func() { ch <- 1 }() // –ë–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è, –ø–æ–∫–∞ main –Ω–µ –ø—Ä–æ—á–∏—Ç–∞–µ—Ç
fmt.Println(<-ch)       // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
```

### –ë—É—Ñ–µ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–∞–Ω–∞–ª
- **–û—Ç–ø—Ä–∞–≤–∫–∞**: –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç, –ø–æ–∫–∞ –±—É—Ñ–µ—Ä –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω.
- **–ü—Ä–∏–µ–º**: –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç, –ø–æ–∫–∞ –±—É—Ñ–µ—Ä –Ω–µ –ø—É—Å—Ç.

```go
ch := make(chan int, 2)
ch <- 1  // OK
ch <- 2  // OK
ch <- 3  // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ (–±—É—Ñ–µ—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω)
```

### Select
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–µ—Ä–≤—ã–π –≥–æ—Ç–æ–≤—ã–π –∫–∞–Ω–∞–ª.
- **Non-blocking** —Å `default`.

```go
select {
case v := <-ch: // –ß—Ç–µ–Ω–∏–µ
case ch <- 10:   // –ó–∞–ø–∏—Å—å
default:         // –ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–π —Ä–µ–∂–∏–º
}
```

### –ü–æ–¥ –∫–∞–ø–æ—Ç–æ–º
- **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞**: –ì–æ—Ä—É—Ç–∏–Ω–∞ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ `sendq` –∏–ª–∏ `recvq`.
- **–ü—Ä–æ–±—É–∂–¥–µ–Ω–∏–µ**: –ü—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ –ø–∞—Ä—ã (–æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å/–ø–æ–ª—É—á–∞—Ç–µ–ª—å).
</details>

<details>
<summary><strong>üß∞ –ü—Ä–∏–º–∏—Ç–∏–≤—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏</strong></summary>

### WaitGroup
- **–¶–µ–ª—å**: –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≥—Ä—É–ø–ø—ã –≥–æ—Ä—É—Ç–∏–Ω.
- **–ü–ª—é—Å—ã**: –ü—Ä–æ—Å—Ç–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.
- **–ú–∏–Ω—É—Å—ã**: –ù–µ–ª—å–∑—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–µ–∑ `Add`.

```go
var wg sync.WaitGroup
wg.Add(2)
go func() { defer wg.Done() }()
go func() { defer wg.Done() }()
wg.Wait()
```

### Mutex
- **–¶–µ–ª—å**: –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –≥–æ–Ω–æ–∫ –¥–∞–Ω–Ω—ã—Ö.
- **–ü–ª—é—Å—ã**: –¢–æ—á–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å.
- **–ú–∏–Ω—É—Å—ã**: –†–∏—Å–∫ –¥–µ–¥–ª–æ–∫–æ–≤.

```go
var mu sync.Mutex
mu.Lock()
counter++
mu.Unlock()
```

### RWMutex
- **–ß—Ç–µ–Ω–∏–µ**: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø.
- **–ó–∞–ø–∏—Å—å**: –≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–π –¥–æ—Å—Ç—É–ø.

### Atomic
- **–¶–µ–ª—å**: –ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫.
- **–ü–ª—é—Å—ã**: –í—ã—Å–æ–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å.
- **–ú–∏–Ω—É—Å—ã**: –¢–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–∏–º–∏—Ç–∏–≤–æ–≤ (int32, pointers).

```go
var counter int32
atomic.AddInt32(&counter, 1)
```
</details>

<details>
<summary><strong>üéØ –ú–µ—Ö–∞–Ω–∏–∑–º—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å—é</strong></summary>

### SingleFlight (golang.org/x/sync/singleflight)
- **–¶–µ–ª—å**: –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –¥–ª—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.
- **–ü—Ä–∏–Ω—Ü–∏–ø**: –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ —Å –æ–¥–Ω–∏–º –∫–ª—é—á–æ–º.

```go
var group singleflight.Group
result, _ := group.Do("key", func() (interface{}, error) {
    return fetchFromDB()
})
```
[–†–µ–∞–ª–∏–∑–∞—Ü–∏—è](https://github.com/rxznik/golearn/blob/main/concurrency/balun/channels/singleflight/main.go)

### RateLimiter (golang.org/x/time/rate)
- **–¶–µ–ª—å**: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, API).
- **–ü—Ä–∏–Ω—Ü–∏–ø**: –¢–æ–∫–µ–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º (token bucket).

```go
limiter := rate.NewLimiter(rate.Every(100*time.Millisecond), 5)
if limiter.Allow() { /* –í—ã–ø–æ–ª–Ω–∏—Ç—å */ }
```
[–†–µ–∞–ª–∏–∑–∞—Ü–∏—è](https://github.com/rxznik/golearn/blob/main/concurrency/balun/channels/rate_limiter/main.go)

### ErrGroup (golang.org/x/sync/errgroup)
- **–¶–µ–ª—å**: –ì—Ä—É–ø–ø–∞ –≥–æ—Ä—É—Ç–∏–Ω —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫.
- **–ü—Ä–∏–Ω—Ü–∏–ø**: –û—Ç–º–µ–Ω–∞ –≤—Å–µ—Ö –∑–∞–¥–∞—á –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –æ—à–∏–±–∫–µ.

```go
g, ctx := errgroup.WithContext(ctx)
g.Go(func() error { return nil })
if err := g.Wait(); err != nil {}
```
[–†–µ–∞–ª–∏–∑–∞—Ü–∏—è](https://github.com/rxznik/golearn/blob/main/concurrency/balun/channels/errgroup/main.go)

### –°–µ–º–∞—Ñ–æ—Ä (—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ –∫–∞–Ω–∞–ª—ã)
- **–¶–µ–ª—å**: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.

```go
sem := make(chan struct{}, 3)
sem <- struct{}{} // –ó–∞—Ö–≤–∞—Ç
<-sem             // –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ
```
[–†–µ–∞–ª–∏–∑–∞—Ü–∏—è](https://github.com/rxznik/golearn/blob/main/concurrency/balun/channels/semaphore/main.go)

### WorkerPool
- **–¶–µ–ª—å**: –ü—É–ª –≤–æ—Ä–∫–µ—Ä–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–¥–∞—á.
- **–ü—Ä–∏–Ω—Ü–∏–ø**: –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ—Ä—É—Ç–∏–Ω + –∫–∞–Ω–∞–ª –∑–∞–¥–∞—á.

```go
jobs := make(chan Task, 100)
for i := 0; i < 10; i++ {
    go func() { for task := range jobs { process(task) } }()
}
```
[–†–µ–∞–ª–∏–∑–∞—Ü–∏—è](https://github.com/rxznik/golearn/blob/main/concurrency/habr/workerpool/main.go)
</details>

<details>
<summary><strong>üí´ Context</strong></summary>

### –¶–µ–ª—å
- –û—Ç–º–µ–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤).
- –ü–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö (request-scoped –¥–∞–Ω–Ω—ã–µ).

### –ü—Ä–∏–Ω—Ü–∏–ø
- **–î–µ—Ä–µ–≤–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤**: –†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –º–æ–∂–µ—Ç –æ—Ç–º–µ–Ω–∏—Ç—å –≤—Å–µ –¥–æ—á–µ—Ä–Ω–∏–µ.
- **–ú–µ—Ç–æ–¥—ã**:
    - `WithCancel` ‚Üí `cancel()`.
    - `WithTimeout` ‚Üí –∞–≤—Ç–æ–æ—Ç–º–µ–Ω–∞ —á–µ—Ä–µ–∑ –≤—Ä–µ–º—è.
    - `WithValue` ‚Üí –ø–µ—Ä–µ–¥–∞—á–∞ –∑–Ω–∞—á–µ–Ω–∏–π.

```go
ctx, cancel := context.WithTimeout(context.Background(), 2*time.Second)
defer cancel()

go func() {
    select {
    case <-ctx.Done():
        return // –ü—Ä–µ—Ä–≤–∞—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é
    }
}()
```
</details>

<details>
<summary><strong>‚öíÔ∏è –ü–∞—Ç—Ç–µ—Ä–Ω—ã —Ä–∞–±–æ—Ç—ã —Å –∫–∞–Ω–∞–ª–∞–º–∏</strong></summary>

### Fan-out
- **–¶–µ–ª—å**: –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á –º–µ–∂–¥—É –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –≤–æ—Ä–∫–µ—Ä–∞–º–∏.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**: –û–¥–∏–Ω –≤—Ö–æ–¥–Ω–æ–π –∫–∞–Ω–∞–ª ‚Üí N –≥–æ—Ä—É—Ç–∏–Ω.

```go
func fanOut(input <-chan int, workers int) {
    for i := 0; i < workers; i++ {
        go func() { for v := range input { process(v) } }()
    }
}
```
[–†–µ–∞–ª–∏–∑–∞—Ü–∏—è](https://github.com/rxznik/golearn/blob/main/concurrency/balun/channels/fan-out/main.go)

### Fan-in
- **–¶–µ–ª—å**: –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–∞–Ω–∞–ª–æ–≤.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**: N –∫–∞–Ω–∞–ª–æ–≤ ‚Üí –æ–¥–∏–Ω –≤—ã—Ö–æ–¥–Ω–æ–π.

```go
func fanIn(inputs ...<-chan int) <-chan int {
    out := make(chan int)
    for _, in := range inputs {
        go func(ch <-chan int) { for v := range ch { out <- v } }(in)
    }
    return out
}
```
[–†–µ–∞–ª–∏–∑–∞—Ü–∏—è](https://github.com/rxznik/golearn/blob/main/concurrency/balun/channels/fan-in/main.go)

### Tee
- **–¶–µ–ª—å**: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –¥–≤–∞ –∫–∞–Ω–∞–ª–∞.

```go
func tee(input <-chan int) (_, _ <-chan int) {
    out1, out2 := make(chan int), make(chan int)
    go func() {
        for v := range input {
            out1 <- v
            out2 <- v
        }
    }()
    return out1, out2
}
```
[–†–µ–∞–ª–∏–∑–∞—Ü–∏—è](https://github.com/rxznik/golearn/blob/main/concurrency/balun/channels/tee/main.go)
</details>
