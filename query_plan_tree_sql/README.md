# EXPLAIN, EXPLAIN ANALYZE –∏ –¥–µ—Ä–µ–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤

–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã `EXPLAIN` –∏ `EXPLAIN ANALYZE` –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø–ª–∞–Ω–æ–≤ (Plan Tree) –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è SQL-–∑–∞–ø—Ä–æ—Å–æ–≤.
–û–Ω–∏ –ø–æ–º–æ–≥–∞—é—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã.

–î–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–∞–±–æ—Ç—ã –Ω–∞–º –Ω–∞–¥–æ –ø–æ–Ω–∏–º–∞—Ç—å, —á–µ–º –î–µ—Ä–µ–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ (Query Tree) –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –î–µ—Ä–µ–≤–∞ –ø–ª–∞–Ω–∞ (Plan Tree).

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | Query Tree                          | Plan Tree                            |
|----------------|-------------------------------------|--------------------------------------|
| –£—Ä–æ–≤–µ–Ω—å        | –õ–æ–≥–∏—á–µ—Å–∫–∏–π (—á—Ç–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å)          | –§–∏–∑–∏—á–µ—Å–∫–∏–π (–∫–∞–∫ –≤—ã–ø–æ–ª–Ω—è—Ç—å)           |
| –°–æ–¥–µ—Ä–∂–∏–º–æ–µ     | SQL-—Å—Ç—Ä—É–∫—Ç—É—Ä—ã (—Ç–∞–±–ª–∏—Ü—ã, —É—Å–ª–æ–≤–∏—è)    | –û–ø–µ—Ä–∞—Ü–∏–∏ (Seq Scan, Index Scan, etc) |

<br/>

<details>
<summary><strong>üêò –î–µ—Ä–µ–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ PostgreSQL</strong></summary>


#### –ß—Ç–æ —Ç–∞–∫–æ–µ –¥–µ—Ä–µ–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤?
–î–µ—Ä–µ–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ (Query Tree) ‚Äî —ç—Ç–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ SQL-–∑–∞–ø—Ä–æ—Å–∞, –∫–æ—Ç–æ—Ä–æ–µ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.
–û–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–æ–π –ø—Ä–∞–≤–∏–ª –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–æ–º –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞.
–ö–∞–∂–¥—ã–π —É–∑–µ–ª –¥–µ—Ä–µ–≤–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π —á–∞—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `SELECT`, `FROM`, `WHERE`).

**–ü—Ä–∏–º–µ—Ä**:  
–î–ª—è –∑–∞–ø—Ä–æ—Å–∞ `SELECT * FROM users WHERE age > 30` –¥–µ—Ä–µ–≤–æ –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —É–∑–ª—ã –¥–ª—è —Å–ø–∏—Å–∫–∞ –æ—Ç–Ω–æ—à–µ–Ω–∏–π (`users`),
—É—Å–ª–æ–≤–∏—è —Ñ–∏–ª—å—Ç—Ä–∞ (`age > 30`) –∏ –≤—ã—Ö–æ–¥–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ (`*`).

#### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–µ—Ä–µ–≤–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
–î–µ—Ä–µ–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö –∫–ª—é—á–µ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤:

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç                    | –û–ø–∏—Å–∞–Ω–∏–µ                                                                     |
|------------------------------|------------------------------------------------------------------------------|
| **–¢–∏–ø –∫–æ–º–∞–Ω–¥—ã**              | `SELECT`, `INSERT`, `UPDATE`, `DELETE` ‚Äî –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏.            |
| **–°–ø–∏—Å–æ–∫ –æ—Ç–Ω–æ—à–µ–Ω–∏–π**         | –¢–∞–±–ª–∏—Ü—ã, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏–ª–∏ –ø–æ–¥–∑–∞–ø—Ä–æ—Å—ã, —É–∫–∞–∑–∞–Ω–Ω—ã–µ –≤ `FROM` (Range Table).     |
| **–†–µ–∑—É–ª—å—Ç–∏—Ä—É—é—â–µ–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–µ** | –î–ª—è `INSERT/UPDATE/DELETE` ‚Äî —Ç–∞–±–ª–∏—Ü–∞, –∫—É–¥–∞ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –∏–∑–º–µ–Ω–µ–Ω–∏—è.           |
| **–í—ã—Ö–æ–¥–Ω–æ–π —Å–ø–∏—Å–æ–∫**          | –°–ø–∏—Å–æ–∫ –≤—ã—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å—Ç–æ–ª–±—Ü—ã –≤ `SELECT`). |
| **–£—Å–ª–æ–≤–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞**          | –õ–æ–≥–∏—á–µ—Å–∫–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –∏–∑ `WHERE`.                                             |
| **–î–µ—Ä–µ–≤–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π**        | –°—Ç—Ä—É–∫—Ç—É—Ä–∞ `JOIN`-–æ–ø–µ—Ä–∞—Ü–∏–π –∏ –ø–æ—Ä—è–¥–æ–∫ –∏—Ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.                           |
| **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —á–∞—Å—Ç–∏**     | `ORDER BY`, `GROUP BY`, `LIMIT` –∏ –¥—Ä—É–≥–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è.                        |
#### –≠—Ç–∞–ø—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–µ—Ä–µ–≤–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
–î–µ—Ä–µ–≤–æ –ø—Ä–æ—Ö–æ–¥–∏—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç—Ç–∞–ø–æ–≤ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π:

 * –ü–∞—Ä—Å–∏–Ω–≥: SQL-–∑–∞–ø—Ä–æ—Å –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è –≤ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–æ–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–æ–µ –¥–µ—Ä–µ–≤–æ (AST).

 * –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü, –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∏ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö. –§–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –∏—Å—Ö–æ–¥–Ω–æ–µ –¥–µ—Ä–µ–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤.

 * –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è (Rewriter):

   - –ó–∞–º–µ–Ω–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π –Ω–∞ –∏—Ö –ø–æ–¥–∑–∞–ø—Ä–æ—Å—ã.

   - –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, RLS ‚Äî Row-Level Security).

 * –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ: –î–µ—Ä–µ–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è –≤ –¥–µ—Ä–µ–≤–æ –ø–ª–∞–Ω–∞ (—Å —Ñ–∏–∑–∏—á–µ—Å–∫–∏–º–∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏: —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è).

#### –ö–∞–∫ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–µ—Ä–µ–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤?

```sql
SET debug_print_parse = ON;
    -- –∏–ª–∏
SET debug_print_rewritten = ON;
    --–∏–ª–∏
SET debug_print_plan = ON;
```

</details>

<br/>

<details>
<summary><strong>üëÄ–ö–æ–º–∞–Ω–¥–∞ <code>EXPLAIN</code></strong></summary>

–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç **–ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º—ã–π –ø–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è** –∑–∞–ø—Ä–æ—Å–∞ –±–µ–∑ –µ–≥–æ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

#### –°–∏–Ω—Ç–∞–∫—Å–∏—Å
```sql
EXPLAIN [OPTIONS] –≤–∞—à_–∑–∞–ø—Ä–æ—Å;
```

#### –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞
```sql
EXPLAIN SELECT * FROM users WHERE age > 30;
```

```
Seq Scan on users  (cost=0.00..15.50 rows=500 width=4)
  Filter: (age > 30)
 ```

#### –ö–ª—é—á–µ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã:

 * –£–∑–ª—ã (Nodes): –û–ø–µ—Ä–∞—Ü–∏–∏, –≤—ã–ø–æ–ª–Ω—è–µ–º—ã–µ PostgreSQL (–Ω–∞–ø—Ä–∏–º–µ—Ä, Seq Scan, Index Scan, Hash Join).

 * Cost (–°—Ç–æ–∏–º–æ—Å—Ç—å):

   - –ü–µ—Ä–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (0.00) ‚Äî —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–ª—É—á–µ–Ω–∏—è –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ–∫–∏.

   - –í—Ç–æ—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (15.00) ‚Äî —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö —Å—Ç—Ä–æ–∫.

   - –ò–∑–º–µ—Ä—è–µ—Ç—Å—è –≤ —É—Å–ª–æ–≤–Ω—ã—Ö –µ–¥–∏–Ω–∏—Ü–∞—Ö (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å–µ—Ä–≤–µ—Ä–∞).

 * Rows: –û–∂–∏–¥–∞–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫.

 * Width: –°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä —Å—Ç—Ä–æ–∫–∏ –≤ –±–∞–π—Ç–∞—Ö.

#### –¢–∏–ø—ã –æ–ø–µ—Ä–∞—Ü–∏–π:

 * Seq Scan: –ü–æ–ª–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã.

 * Index Scan: –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∏–Ω–¥–µ–∫—Å–∞.

 * Nested Loop: –í–ª–æ–∂–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –¥–ª—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü.

 * Hash Join/Hash Aggregate: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ö—ç—à-—Ç–∞–±–ª–∏—Ü –¥–ª—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∏–ª–∏ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏.

 * Sort: –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö.

</details>

<br/>


<details>
<summary><strong>üìä–ö–æ–º–∞–Ω–¥–∞ <code>EXPLAIN ANALYZE</code></strong></summary>

–í—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏.

#### –û—Ç–ª–∏—á–∏—è –æ—Ç `EXPLAIN`
 * –ó–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è.
 * –î–æ–±–∞–≤–ª—è—é—Ç—Å—è —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ: –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫.

#### –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞
```sql
EXPLAIN ANALYZE SELECT * FROM users WHERE age > 30;
```

```
Seq Scan on users  (cost=0.00..15.50 rows=500 width=4) (actual time=0.012..0.215 rows=480 loops=1)
  Filter: (age > 30)
  Rows Removed by Filter: 20
Planning Time: 0.045 ms
Execution Time: 0.250 ms
 ```

#### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
 * actual time: —Ä–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –≤ ms (–Ω–∞—á–∞–ª–æ..–∫–æ–Ω–µ—Ü).

 * rows: —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫.

 * loops: —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤—ã–ø–æ–ª–Ω—è–ª–∞—Å—å –æ–ø–µ—Ä–∞—Ü–∏—è.

 * Planning Time: –≤—Ä–µ–º—è –Ω–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø–ª–∞–Ω–∞.

 * Execution Time: –æ–±—â–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

</details>


